# **coink_technical_test - English**
### Backend Developer Technical Test for Coink: A Fintech Startup.
This repository contains the backend technical test for Coink, a financial technology startup.

---

# Proyect Structure
## Branches:
The repository contains three main branches:
1. **main**: The primary branch.
2. **documentation**: Dedicated to project documentation.
3. **development**: Used for ongoing development work.

Previously, database scripts were managed in a separate branch. However, this was deemed unnecessary, and those changes were merged into the `development` branch.

---

## **Folders**
The project includes three principal folders:

1. **coink_api**: 
   - Contains the API source code. This folder will be discussed in detail later.

2. **docs**: 
   - Includes the **Entity-Relationship Diagram (ERD)**.
   - Contains API testing images within the `api_test_images` subfolder.

3. **scripts**:
   - **`coink_db_setup.sql`**: The main database creation script.
   - **`coink_db_integrity_test.sql`**: Script for testing database constraints and key integrity through insertions and queries.
   - **`coink_test_data.sql`**: Script for populating the database with test data.
   - **`coink_stored_procedures.sql`**: Contains all stored procedures for the database. Ensure there are no duplicate procedures before running it.
   - **`coink_sp_test.sql`**: Script for testing stored procedures functionality.

---

### DISCLAIMER
If you are using **DBeaver**, it is recommended to set up the database name directly in the PostgreSQL connection. This is necessary because **DBeaver** does not support commands like `\c coink_db` to switch between databases and perform operations on a newly created schema or database.
### Steps to Follow
1. Configure the PostgreSQL connection to point directly to the database you want to use (`coink_db`).
2. Comment out the lines related to creating and dropping the database in the script to avoid conflicts with DBeaver:

```postgresql
   --- drop database if exist coink_db;
   --- create database coink_db;
```

3. Once connected to the database, you can execute the following operations and the whole script will run well:

```postgresql
	drop schema if exists public cascade;
	create schema public
```
### Additional Notes
If you use a client that supports the `\c` command, such as `psql`, the original script will work
``` postgresql
drop database if exist coink_db;
create database coink_db;

\c coink_db;

drop schema if exist public cascade;
create schema public;
```
# Specifications and settings files
Ignoring the core project api files that the command "dotnet new webapi -n MyAPI" creates, there is just 3 really important configuration archives to get the server and the API up:
1. Program.cs
2. appsettings.json
3. launchSettings.json
You have into coink_api folder the first one and the last one but not the second one because of environment variables, then Im going to leave you the template so you can run the project.

---

# **Specifications and Configuration Files**
Apart from the core project files generated by running the command `dotnet new webapi -n MyAPI`, there are three essential configuration files needed to run the server and API:
1. **Program.cs**
2. **appsettings.json**
3. **launchSettings.json**

The first and third files are already present in the **coink_api** folder. However, the **appsettings.json** file is excluded due to environment variable considerations. Below is a template to set up the project:

---

### **appsettings.json Template**
To run the project, create an `appsettings.json` file in the **coink_api** folder with the following structure:
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Database=coink_db;Username=your_username;Password=your_password"
  }
}
```

Replace `your_username` and `your_password` with your PostgreSQL credentials.

---

```
# API source
I developed this project thinking in a layered architecture to can keep separated the responsibilities, however, you will find some elements of other patterns or architecture, so this is a pretty quick review:
#### **1. bin**
- **Description**: Automatically generated during the build process.
- **Contents**: Compiled files like `.dll` and `.exe`.
- **Usage**: Managed by .NET; no need for manual changes here.

---

#### **2. Common**
- **Description**: Contains shared utilities or classes used across multiple layers of the project.
- **Typical Contents**:
  - Classes like `ServiceResult` for standardized responses.
  - Global constants or enumerations.

---

#### **3. Controllers**
- **Description**: Handles incoming HTTP requests.
- **Contents**:
  - **`LocationController.cs`**: Handles requests related to countries, regions, and municipalities.
  - **`UsersController.cs`**: Manages user-related operations.
- **Responsibility**:
  - Acts as the entry point for the client (e.g., Postman or Swagger) and delegates work to the service layer.

---

#### **4. Data**
- **Description**: Contains database-related classes.
- **Contents**:
  - **`ApplicationDbContext.cs`**: Defines how the app interacts with the database using Entity Framework.
- **Responsibility**:
  - Configures tables, relationships, and other database settings.

---

#### **5. DTOs (Data Transfer Objects)**
- **Description**: Defines simplified models used to transfer data between layers.
- **Contents**:
  - Files like **`CountryDto.cs`**, **`MunicipalityDto.cs`**, **`RegionDto.cs`**, **`UserByLocationDto.cs`**.
- **Responsibility**:
  - Acts as a lightweight structure to exchange data between layers without exposing the database models directly.
  - Reduces coupling between the database and upper layers.

---

#### **6. Middleware**
- **Description**: Contains custom components for request and response handling.
- **Contents**:
  - **`ExceptionMiddleware.cs`**: Globally handles unhandled exceptions and provides consistent responses to clients.
- **Responsibility**:
  - Centralizes error handling.
  - Adds features like logging or authorization for every request.

---

#### **7. Models**
- **Description**: Represents the database tables as classes.
- **Contents**:
  - Classes like **`Country.cs`**, **`Region.cs`**, **`User.cs`**, etc.
- **Responsibility**:
  - Mirrors the database schema.
  - Used in `ApplicationDbContext` for database interaction.

---

#### **8. obj**
- **Description**: Temporary files created during the build process.
- **Contents**:
  - Intermediate files used by the .NET compiler.
- **Usage**: Similar to `bin`, this is managed automatically and requires no manual intervention.

---

#### **9. Properties**
- **Description**: Contains configuration files related to the assembly.
- **Contents**:
  - **`launchSettings.json`**: Defines local development settings like ports and profiles.
- **Usage**: Used for local debugging and testing configurations.

---

#### **10. Services**
- **Description**: Contains business logic and service implementations.
- **Contents**:
  - **Interfaces**: **`ILocationService.cs`**, **`IUserService.cs`**.
  - **Implementations**: **`LocationService.cs`**, **`UserService.cs`**.
- **Responsibility**:
  - Implements logic for handling core operations (e.g., user registration, location validation).
  - Acts as the intermediary between controllers and data.

---

#### **11. Root Files**
- **`appsettings.json`**: Global configuration file for the project (e.g., database connection strings).
- **`coink_api.csproj`**: Project configuration file used by .NET during compilation.
- **`Program.cs`**: The entry point of the application; configures services and middleware during startup.

---
